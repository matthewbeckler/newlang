#!/usr/bin/env python

test = """     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ """

real = """                                                                                                                 |                                                                                       
               +-+ +---------+     +-------------+                                   +---------------------------|-+         +-------------------------------------------+             +---------+       
               | | |         |     |             |                                   |                           | |         |                                           |             |         |       
           +-------|---------------|-------------------------------------------------|-----+                     | |         |         +---------+                       | +-----------|-------+ +-----+ 
           |   | | |         |     |             |                                   |     |                     | |         |         |         |                       | |           |       |       | 
           |   | +-------------------------------+               +-------------------------|---------------------|-------------------------------|-----------------------|-------------|---+   |       | 
           |   |   |         |     |                             |                   |     |                     | |         |         |         |                       | |           |   |   |       | 
           |   |   |     +---------------------------------------|-------------------------|-------------+       | | +-+     +-------------------------------+           | |           |   |   |       | 
           |   |   |     |   |     |                             |                   |     |             |       | | | |               |         |           |           | |           |   |   |       | 
       +---|---|---|-----+   |     |                             |               +---|-------------------|-------|---|-----------------|---------|-----------------------|-------------|---|-+ +-+     | 
       |   |   |   |         |     |                             |               |   |     |             |       | | | |               |         |           |           | |           |   | |   |     | 
       |   |   | +-----------------|---------+                   |               |   |     |     +-------|---------|-|-----------------+         |           |           | |         +-|---|---------+ | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | | |                         |           |           | |         | |   | |   |   | | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | +-|-------------------------------------------------|-|-----------|-----|-------+ | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | |   |                         |           |           | |         | |   | |   |     | 
       |   |   | | |     +---|-----|---------|---------------------------------------|-----------|-------|-------|-|-----------------------------------------+ +-+       | |         | |   | |   |     | 
       |   |   | | |     |   |     |         |                   |               |   |     |     |       |       | |   |                         |             | |       | |         | |   | |   |     | 
       |   |   | | |     |   |   +-----+     |                   |               |   |     |     |       |     +-|-|---|-------------------------|-----------------------|-----+     | |   | |   |     | 
       |   |   | | |     |   |   | |   |     |                   |               |   |     |     |       |     | | |   |                         |             | |       | |   |     | |   | |   |     | 
 +---------|-------|-------------|-|---|-------------+           |               |   |     |     |       |     | | |   +---------------------------------------|-|-------|-----|-+   | |   | |   +---+ | 
 |     |   |   | | |     |   |   | |   |     |       |           |               |   |     |     |       |     | | |                             |             | |       | |   | |   | |   | |       | | 
 |     |   +---|-|-|---------|-----|-----+   |       +-------------------------+ |   |     +---------------------|-|-----------------------------|-------------|---------|-|-----|---|-----|-+       | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |           |       |     | | |                             |             | |       | |   | |   | |   |         | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |           +-------|-------|-------------------------------|---------------|-+     | |   | |   | |   | +-----+ | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | |   | |     | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | +-|-+     | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | | |       | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |         +---------------|-|-----------------------------------------------|-|-----------------------------+ +-|-+ 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |         |         |     | | |                             |             | | |     | |   | |   | | | |     |   |   
 |     |       | | |     |   +---|-|---|-|---|-------+ +-+       |             | |   |         |         |     | | +-----------------+           |             | | |     | |   | |   | | | | +-----+ | S 
 |     |       | | |     |       | |   | |   |       | | |       |             | |   |         |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   +-----------|-------|-------|-----|-----|---------------------------------------------+   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   | |       | | |     |       | |   | |   |       | | |       |             | |   |     |   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   | |       | | |   +-|-------|-|-----|---|---------|-+ +-----|-------------|-----------|---|---------+     | |                   |           |             | | | +---|-------|---|-|---|-|---|-|---+ 
 |   | |       | | |   | |       | |   | |   |       | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | +-|-----+   | | |   +-|---------|-------------+   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | | |   |   | | |     |       | |   | |   |   |   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | | +---|---+ | +-------------------|-|-------|-----------------------------+ |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       |       | |   | |   |   |   | |   |     |               |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       | +-----|-|---------|---|---|-|---|-----|---------------|-----+   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       | |     | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   J | | | |   | | |   
 | | |     |     | +---------+   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |     | | |   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |     +---------|---|-|-----------|-|---|-----|-------------------|-----|---|---------+     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |               |   | |   |   |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |       +-------|---|-|-----+ |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |       |       |   | |   | | |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       +-|---|-------|---|---|---|-----|-----+ +-----|-----------|-|---|-------------|-----|-+ +-----------------------------|-------------|-----+   | |   | |   | | | | |   | | |   
 | | |     |     | |         |   | |   | |   |   |   | |   |       |     |       |   | |   | | |         |     |   |                 |           |             | | |     | |   | |   | | | | |   | | |   
 | | |     +---------------------|-----|-|-------------|-----------|-------------|---|-|---|-+ |         |     |   |                 |           |             | | |   +-------|---+ | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     +-------------------|-----------|---|-|-|-----+ | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     |     |             | | |   | | |   | | | | |   | |   | | |   
 | | |           | +---------|-----|---|-|---|---|-----+   |       |     |       |   | +---|-------------|---------------------------|----E|-+   |             | | |   | | |   | | | | |   | |   | +-+   
 | | |           |           |   | |   | |   |   |   |     |       |     |       |   |     |   |         |     |   |                 |     | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     +---+ |   | |   | |   |   |   |   +---------|-----|-----------------|---|---------|---------------------------+     | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   |   |   |   | |       |     |       |   |     |   |         |     |   |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   | +---------|---------------|---------------------|---------|-----+   |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | +-------------|-----|---|-----|-----|-----|-|-----|-----|-------|-----|-----------|---------|-------------------|-----------------------|-|-----------------+ | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |               | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | +-|---------------|-----------|-----|---|-------------------------------------------|-----|-+             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   T | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |         +-|-----|-----|---|-|---|---------|-----|-----------|-----|-------|---|---------|-------------------------------------------|-|---|-|-------------|-------|---+ | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   | +-------|-|-+   |   | |   | |   | |   | | |   | | | |       | +---|-------|---|-----|---|-------------------|-----------------------|-------------------------------|-|-|-|---|---------------+   
 |   | |       | | |   |   | |   | |   | |   | | |   | | | |       | |   |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   |   | |   | |   | |   | | |   | +-------------|---------------|---------+         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   |   | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   | +-|-|-----------|-----|---------|-|-------|-|---|-----------------|-------------|---------|-----------------------|-----|-|---------------|-----|-+ | | | | | +---+ |   |   |   
 |   | |       | | |   | | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | |   | | | | |       |   |   |   
 |   | |       | | |   +-----|---|-------------------|---|---------|-----|-----------|-----------------------------|-------------------------|-----+             | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | +-----|---|-|-----------------|-------|-|---------------------------------------------+                       | |   |               | |   | |   | | | | |       |   |   +-+ 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       |   |     |             |                                 | |   |               | |   | |   | | | | |       |   |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       +---------|-------------|-------------+                   | +---|---------------|-|---------+ | +-------------+ |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             |             |                   |     |               | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             +-------------|---------+         |     |     +-----+   | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |         |         |     |     |     |   | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   +-----|---------|-----------|-----|---------|-------------|---------------+ | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     |     |   | |   | |     |   | |       | | |   | | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | +-------|-------|-----------------------|-----+ 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   |   
 |   | |       | | |     | |   +---+   | |   | | |   |   +-----------|---|---------------------------------------------|---|---------------|-----------|-|---|---|-----|-|-----|---|-----------|-----|-+ 
 |   | |       | | |     | |   | |     | |   | | |   |     |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   | | 
 |   | |       | | |     | | +-----+   | |   | | |   |     +-------|-----|-----------|---------+                       |   |     |         | +-------------+ |   | |   | |     |   | |       | | |   +-+ 
 |   | |       | | |     | | | | | |   | |   | | |   |             | |   |           |     |   |                       |   |     |         | |   |     | | | |   | |   | |     |   | |       | | |       
 |   | |     +---|-------+ | | | | |   | |   | | |   | +-------------|---|-----------|-----|---|-----------------------|---|-----|---------|-|---|-----+ | | |   | +-----------------------+ | | |   +-+ 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       |   |     |         | |   |       | | |   |     | |     |   | |     | | | |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | +-|-----|---------|-|---|-------|-|-----------|-|---------|-|-----|---+ |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | |     |         | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | +---|---+     | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | +-+ | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | |   | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               +-----------|-----|---|---+ +-|---|-----+ | | |   |     | |     |   | +-----+ |   | |   | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               |       | | | |   |   |   |   |   |     | | | |   |     | |     |   |         |   | |   | 
 |   | |     +---------------|-|-|-|-----|---|-|-|-------------------+   |           |     +-------------------|---------|---------------|---|---|-----------|---------+ |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | M | |   |       |     |   |         |   | |   | 
 |   | |       | | |     +---|-|---|---|---------|-----+           |     |           |         |               |     +-|---|-|---|-----------|---|-----|-|---|-----------------------------------|-----+ 
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 +-------------|---------|---|---|-----------|-|-----|---------+   |     |         +-|-+ +-----|---------------|-----|-------|---|---|---|---------+   | | | |   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |               |     | | | | |   |   |   |   |   | |   | | | |   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       +---------------|-|---|---------------------|-------|-+   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   +-----+ +-------+ 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   |       | | |   | 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | +-----|-+     |     |   |   |       | | |   | 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |       | |     |     |   |   |       | | |   | 
     | |       | | |     | | | | | | +---------|-+   | +-------|---------|-------------|-|-------------|-------------------------|---|---|---|---|-------|-----+ +-+     |   +---------------+ | | |   | 
     | |       | | |     | | | | | | | | |   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | | +---|G--+   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |   +-|-|-----------|---------------|-----|-------------|-------|-----|-|-|-|-----|-----------|-----------|---------------|---|-|---+   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |   | | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |       |     | | | |   | 
     | |       | | | +---|-|-|-+   | | |     | |   | | |       |   |     |         | | | +-----|-------|-------+     | +-----|---|-----------|-----|-----------|-------------|-|---------+   | | | |   | 
     | |       | | | |   | | |     | | |     | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | |   | 
     | |       | | | |   | | |     | | +-------|-------|---------------------------|-------------------|-------------------|-----|---------------------|-|-----|-------------|-|-------------|---|-|-+ | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | +-----------------|-+   | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | | |   |   |   |   |     | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | +-------|-----|---+   |   |     | +-----|---------|---|-------+ | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     +-------------+       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |               | |         |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | +----------------P--|-+ | | |       |   |               | |         |       |             | | | | | | |   | +---------------|-------+         |   | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | |         |       |             | | | | | | |   | |     |   |     |                 |   | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | +-------|---------------------|-|-----|---|-----|-----|---------|-------------------+ | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | | | | | | |   | |     |   |     |                 | | | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | +---|-|---|---|-|-----|-----------------+         | | | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             |   | | | | |   | |     |   |     |       |         | | | |     | | |   | | | | | | 
     | |   +---+ | | |   |   |     | |       | | | | | |       |   |             +-|-|-|---------------|-------------------+ | | |   | |     |   | +---|-------+         | | | |     | | |   | | | | | | 
     | |   |     | | |   |   |     | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |                 | | | |     | | |   | | | | | | 
     | |   |     | | |   |   |   +---|---------|-|-|-|---------|---|-----------------|-----------------------------------------|-----|-|-----|---|-|-------+ +-----+ +---|-----|-+ +-|-|---------|---|-+ 
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |   | |     | |   | | | | | | | | |   | | | | |   
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   +-----|-|-----|-----|---|-|---------|-----+ |   | | | | | | | | |   | | | | |   
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |       | | |   | |     |   | |   |   | |       |   | | | | | | | | |   | | | | |   
     | |   |     +-|---------|-----|---------|---|-|---|-------|-----+           | | | |       |       |             | +---+ | | |   | |     +---|-|---------------------|---|-----|-|-|-|-----+ | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | | |       |       |             | |   | | | |   | |         | |   |   | |       |   | | | | | | | | |   |   | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | +-------------------------------|-|-+ | | | |   | |         | |   |   +-|-+     |   | | | | | | | | |   |   | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | |   
   +---------------|-|---|-------|-|---------|---|-|-|-|-------------|-----------|-----|-------|---------------------|-|---|-|---------|---------|-|---|-----|-----------|-----|---|---|-|-------------+ 
   | | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | | | 
   | | |   | +-+   | |   |   +---|-|-+       | | | | | +---------------------------|---|-------|-------|----------K----|---|---|-----+ |         +-------------+     |   +---+ | | +-+ | |   |   | | | | 
   | | |   | | |   | |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     | |   |   | | | | 
   | | |   | | |   +-|-----------|-----------|-|-----------------------------------|-----------|-----------------------|-|-|-|---------|---------------|-------------------|---|-------|-+   |   +---|-+ 
   | | |   | | |     |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     |     |     | |   
   | | |   | | |     |   |       | |         +-|---|-|---------------------------|-|-----------|-------------------------|---+ | |     |           |   |     +-+   +-+     |   | |     |     |   +-----+ 
   | | |   | | |     |   |       | |           | | | |         |   | |           | |   |       |       |             | | | |   | |     |           |   |       |   |       |   | |     |     |   | | | | 
   | | |   | | |     |   |       | +-----------|-----|---------|---|-------------|-----|-------|---------------------|-|-|-+   | |     |           |   |       |   |       |   | |     |     |   | | | | 
   | | |   | | |     |   |       |             | | | |         |   | |           | |   |       |       |             | | |     | |     |           |   |       |   |       |   | |     |     |   | | | | 
   +-|-+   | | |     |   |       |             | | | |         |   | |           | |   |       |       | +-----+   +-+ | +---+ | | +---------------------------------------|-----------------|-+ | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       |       | |     |   |   |     | | | |   |           |   |       |   |       |   | |     |     | | | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       | +-----|-|---------|---|-----|-|-|-----|---------+ |   |       |   | +-----|--V--|---+ |     | | | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       | |     | |     |   |   |     | | | |   |         | |   |       |   | |     |   | |   | |     | | | | | | 
 +---|-+   | +-|-----|-------------------------|-----|-------------|-------------|-----|-----+ | |     | +-----|---|-------------------|---------|---+ |       |   | |     |   | | +-+ | +-----+ | | | | 
 |   | |   |   |     |   |       |             | | | |         |   | |           | |   |     | | |     |       |   |   |     | | | |   |         | | | |       |   | |     |   | | |   | |   |   | | | | 
 |   | |   |   |     |   |       |             | | | +---------|-----|-----------|-|---------|-|-|-----+       |   | +-|---------|-----|---------+ +-|-|-----------+ |     |   | | |   | |   |   | | | | 
 |   | |   |   |     |   |       |             | | |           |   | |           | |   |     | | |             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |   +-|-----------------|-------|---------------------------------|-+           +-----|-----|-|-+             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |     |   |   |     |   |       |             | | |           |   |               |   |     | |               |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |     |   |   |     |   |       |             | | |           |   +-------------------------------------------+   | +-|-------|---+   |             | |       |     |   +-|-----|-|---|-----|---+ | | | 
 |     |   |   |     |   |       |             | | |           |                   |   |     | |                   |   |     | | |     |             | |       |     |   | |   | | |   | |   |     | | | 
 +-----------------------|-------|-------------------------------------------------|---------|---+                 |   +-----|-+ |     |             | |       |     |   | +---|---|-----+   |     | | | 
       |   |   |     |   |       |             | | |           |                   |   |     | | |                 |         |   |     |             | |       |     |   |     | | |   |     |     | | | 
       |   |   |     |   |       |             | | |           |                   |   |     +-|-|-----------------|-------+ |   |     |             | +-------|---------------|-------------|-----|-|-+ 
       |   |   |     |   |       |             | | |           |                   |   |       | |                 |       | |   |     |             |         |     |   |     | | |   |     |     | |   
       +---+   |     |   |       +-------------|-|-|-----------------------------+ +---|-------|-------------------|---------|---------|-------------|-+       |     +---|-------+ |   |     |     | |   
               |     |   |                     | | |           |                 |     |       | |                 |       | |   |     |             | |       |         |     |   |   |     |     | |   
         +---------+ |   |                     | +-|-----------|-----------------------|-----------------------------------|-|---------|-+       +---|---------|---------|-----+   |   |     |     | |   
         |     |   | |   |                     |   |           |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     | |   
         |   +-------+   |                     |   +-----------|---------------------------------|---------------------------|---|-----|-|-------------------------------|-------------|-----|-----|-+   
         |   | |   |     |                     |               |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     |     
         +---+ |   |     |                     +---------------+                 +-----+       +-+         +-------+       | +---|-----|-|-------|-------------------------------------|-+   +-----+     
               |   |     |                                                                                 |               |     |     | |       |   | |       |         |         |   | |               
               |   |     |         +-----------------------------------------------------------------------+               +-----|-------|-----------|-|-------+         |         +-----+               
               |   |     |         |                                                                                             |     | |       |   | |                 |             |                 
   +-----------|---+     |         |                     +-----------------------------------------------------------------------|-------+       |   +---------------------------------|---------------+ 
   |           |         |         |                     |                                                                       |     |         |     |                 |             |               | 
   +---+ +-----+ +---------------------------------------|-----------------------------------------------------------------------|-----|-----------------------------------------------|---------------+ 
       | |       |       |         |                     |                                                                       |     |         |     |                 |             |                 
       | |       +-----------------|---------------------------------------------------------------------------------------------------+ +---------------------------------+           +---------------+ 
       | |               |         |                     |                                                                       |       |       |     |                 | |                           | 
       +-+               +---------+                     +-----------------------------------------------------------------------+       +-------+     +-----------------+ +---------------------------+ 
                                                                                                                                                                                                         """

def part_one(string):
    rows = string.split("\n")
    letters = []
    max_x = len(rows[0])
    max_y = len(rows)
    steps = 0

    # we know we start in the top row
    y = 0
    x = rows[0].index(rows[0].strip())
    # velocity is initially going down (y increasing)
    vy = 1
    vx = 0
    while True:
        # first, look at the character we are standing on
        c = rows[y][x]
        print "===== pos(%d,%d), vel(%d,%d), \"%s\" =====" % (y, x, vy, vx, c)

        if c == " ":
            # all done
            print "Reached the end, all done!"
            return letters, steps

        if c in ["|", "-"]:
            # normal pipe, carry on
            pass
        elif c == "+":
            # plus pipe, change velocity
            if vy != 0:
                # moving vertically, check left and right for non-blanks
                if x > 0 and rows[y][x - 1] != " ":
                    print "turn left"
                    vy = 0
                    vx = -1
                if x < (max_x - 1) and rows[y][x + 1] != " ":
                    print "turn right"
                    vy = 0
                    vx = 1
            else:
                # moving horizontally, check up and down for non-blanks
                if y > 0 and rows[y - 1][x] != " ":
                    print "turn up"
                    vy = -1
                    vx = 0
                if y < (max_y - 1) and rows[y + 1][x] != " ":
                    print "turn down"
                    vy = 1
                    vx = 0
        else:
            # not blank, not a pipe, must be a letter
            print "found letter %s" % c
            letters.append(c)
        
        y += vy
        x += vx
        steps += 1
        

letters, steps = part_one(test)
print "Part one, test: letters =", "".join(letters), ", steps = %d" % steps
letters, steps = part_one(real)
print "Part one, real: letters =", "".join(letters), ", steps = %d" % steps

